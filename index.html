<h1>Mastermind</h1>

<button onclick="init();">Nouvelle Partie</button>

<div id="answer">
	<span id="a_1"></span>
	<span id="a_2"></span>
	<span id="a_3"></span>
	<span id="a_4"></span>
</div>
<div id="game">
</div>

<div id="button">
</div>


<script>
	var colors = [
		'red',
		'blue',
		'green',
		'yellow',
		'orange',
		'violet',
		'brown',
		'grey'
	];
	
	var game = [];

	var nbProposition = 1;
	var proposition = [];


	function init() {
		for (var i = 4; i >= 1; i--) {
			var n = Math.floor(Math.random() * colors.length);
			var color = colors[n];
			game.push(color);
		}

		document.getElementById("a_1").innerHTML = "?";
		document.getElementById("a_2").innerHTML = "?";
		document.getElementById("a_3").innerHTML = "?";
		document.getElementById("a_4").innerHTML = "?";

		for (var i = 10; i >= 1; i--) {
			var prop = document.createElement("div");
			var pattern = i+" - <span id='"+i+"_1'></span><span id='"+i+"_2'></span><span id='"+i+"_3'></span><span id='"+i+"_4'></span><span id='res_"+i+"'></span>";

			prop.setAttribute("id", "proposition_"+i);

			prop.innerHTML = pattern;

			document.getElementById("game").appendChild(prop);
		}

		for (var i = colors.length - 1; i >= 0; i--) {
			var buttonColors = document.createElement("div");
			var pattern = colors[i];

			buttonColors.setAttribute("id", "button_"+i);
			buttonColors.setAttribute("onclick", "add("+i+")");
			buttonColors.setAttribute("class", "button_colors");

			buttonColors.innerHTML = pattern;

			document.getElementById("button").appendChild(buttonColors);
		}
	}

	function add(color){
		// If user already set 4 colors
		if (proposition.length != 4) {
			var pos = proposition.length+1;

			document.getElementById(nbProposition+"_"+pos).innerHTML = colors[color];

			proposition.push(colors[color]);

			// 4 colors are set, submit button appears
			if (proposition.length == 4) {
				var submitButton = document.createElement("div");
				var submitButtonContent = "<button>Soumettre</button>";

				submitButton.setAttribute("id", "submit");
				submitButton.setAttribute("onclick", "submit()");

				submitButton.innerHTML = submitButtonContent;

				document.getElementById("button").appendChild(submitButton);
			}
		}
	}

	function submit(){
		var res = [];
		for (var i = 0; i < proposition.length; i++) {
			// Place is right, color is right
			if (proposition[i] == game[i]) {
				res.push(1);
			// Place is wrong, color is right, just somewhere else
			}else if(game.indexOf(proposition[i]) > 0){
				console.log(game.indexOf(proposition[i]));
				res.push(2);
			// Color is not right for this game
			}else{
				res.push(0);
			}
		}

		displayResult(res);

		nbProposition++;
		proposition = [];
	}

	function displayResult(result) {
		var resHTML = "";
		for (var i = 0; i < result.length; i++) {
			if (result[i] == 1) {
				resHTML = resHTML+"<span>ROUGE</span>";
			}else if(result[i] == 2){
				resHTML = resHTML+"<span>BLANC</span>";
			}else{
				resHTML = resHTML+"<span></span>";
			}
		}

		var result = document.createElement("div");

		result.innerHTML = resHTML;

		document.getElementById("res_"+nbProposition).appendChild(result);

		// When result is display, remove submit button 
		var buttonSubmit = document.getElementById("submit");
		buttonSubmit.outerHTML = "";
		delete buttonSubmit;
	}

</script>